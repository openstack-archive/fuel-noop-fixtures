class { 'Galera::Client' :
  before             => 'Class[Osnailyfacter::Mysql_access]',
  custom_setup_class => 'galera',
}

class { 'Ironic::Db::Mysql' :
  allowed_hosts => [ 'node-1', 'localhost', '127.0.0.1', '%' ],
  charset       => 'utf8',
  collate       => 'utf8_general_ci',
  dbname        => 'ironic',
  host          => '127.0.0.1',
  password      => '6WfFFkO2XOLPmgtLhIWyf1kN',
  user          => 'ironic',
}

class { 'Mysql::Config' :
}

class { 'Mysql::Params' :
}

class { 'Mysql::Python' :
  package_ensure => 'present',
  package_name   => 'MySQL-python',
}

class { 'Mysql::Server' :
}

class { 'Osnailyfacter::Mysql_access' :
  ensure      => 'present',
  before      => 'Class[Ironic::Db::Mysql]',
  db_host     => '192.168.0.2',
  db_password => 'POvhJ6iQOcf9d4TCsul2ZRQI',
  db_user     => 'root',
}

database { 'ironic' :
  ensure   => 'present',
  charset  => 'utf8',
  provider => 'mysql',
  require  => Class[Mysql::Server],
}

database_grant { 'ironic@%/ironic' :
  privileges => 'all',
  provider   => 'mysql',
  require    => Database_user[ironic@%],
}

database_grant { 'ironic@127.0.0.1/ironic' :
  privileges => 'all',
  provider   => 'mysql',
  require    => Database_user[ironic@127.0.0.1],
}

database_grant { 'ironic@localhost/ironic' :
  privileges => 'all',
  provider   => 'mysql',
  require    => Database_user[ironic@localhost],
}

database_grant { 'ironic@node-1/ironic' :
  privileges => 'all',
  provider   => 'mysql',
  require    => Database_user[ironic@node-1],
}

database_user { 'ironic@%' :
  password_hash => '*2E26E04E210CD398F48B1B23309B64B2A621A4F1',
  provider      => 'mysql',
  require       => Database[ironic],
}

database_user { 'ironic@127.0.0.1' :
  ensure        => 'present',
  password_hash => '*9A4D19763554EADB8727156938A3687AECE5188F',
  provider      => 'mysql',
  require       => Database[ironic],
}

database_user { 'ironic@localhost' :
  password_hash => '*2E26E04E210CD398F48B1B23309B64B2A621A4F1',
  provider      => 'mysql',
  require       => Database[ironic],
}

database_user { 'ironic@node-1' :
  password_hash => '*2E26E04E210CD398F48B1B23309B64B2A621A4F1',
  provider      => 'mysql',
  require       => Database[ironic],
}

file { '192.168.0.2-mysql-access' :
  ensure  => 'present',
  content => '
[mysql]
user     = \'root\'
password = \'POvhJ6iQOcf9d4TCsul2ZRQI\'
host     = \'192.168.0.2\'

[client]
user     = \'root\'
password = \'POvhJ6iQOcf9d4TCsul2ZRQI\'
host     = \'192.168.0.2\'

[mysqldump]
user     = \'root\'
password = \'POvhJ6iQOcf9d4TCsul2ZRQI\'
host     = \'192.168.0.2\'

[mysqladmin]
user     = \'root\'
password = \'POvhJ6iQOcf9d4TCsul2ZRQI\'
host     = \'192.168.0.2\'

[mysqlcheck]
user     = \'root\'
password = \'POvhJ6iQOcf9d4TCsul2ZRQI\'
host     = \'192.168.0.2\'

',
  group   => 'root',
  mode    => '0640',
  owner   => 'root',
  path    => '/root/.my.192.168.0.2.cnf',
}

file { 'default-mysql-access-link' :
  ensure => 'symlink',
  path   => '/root/.my.cnf',
  target => '/root/.my.192.168.0.2.cnf',
}

mysql::db { 'ironic' :
  charset     => 'utf8',
  enforce_sql => false,
  grant       => 'all',
  host        => '127.0.0.1',
  password    => '*2E26E04E210CD398F48B1B23309B64B2A621A4F1',
  require     => Class[Mysql::Config],
  sql         => '',
  user        => 'ironic',
}

openstacklib::db::mysql::host_access { 'ironic_%' :
  database      => 'ironic',
  mysql_module  => '0.3',
  password_hash => '*2E26E04E210CD398F48B1B23309B64B2A621A4F1',
  privileges    => 'ALL',
  user          => 'ironic',
}

openstacklib::db::mysql::host_access { 'ironic_127.0.0.1' :
  database      => 'ironic',
  mysql_module  => '0.3',
  password_hash => '*2E26E04E210CD398F48B1B23309B64B2A621A4F1',
  privileges    => 'ALL',
  user          => 'ironic',
}

openstacklib::db::mysql::host_access { 'ironic_localhost' :
  database      => 'ironic',
  mysql_module  => '0.3',
  password_hash => '*2E26E04E210CD398F48B1B23309B64B2A621A4F1',
  privileges    => 'ALL',
  user          => 'ironic',
}

openstacklib::db::mysql::host_access { 'ironic_node-1' :
  database      => 'ironic',
  mysql_module  => '0.3',
  password_hash => '*2E26E04E210CD398F48B1B23309B64B2A621A4F1',
  privileges    => 'ALL',
  user          => 'ironic',
}

openstacklib::db::mysql { 'ironic' :
  allowed_hosts => [ 'node-1', 'localhost', '127.0.0.1', '%' ],
  charset       => 'utf8',
  collate       => 'utf8_general_ci',
  dbname        => 'ironic',
  host          => '127.0.0.1',
  mysql_module  => '0.3',
  password_hash => '*2E26E04E210CD398F48B1B23309B64B2A621A4F1',
  privileges    => 'ALL',
  require       => Class[Mysql::Python],
  user          => 'ironic',
}

package { 'mysql-client' :
  name => 'MySQL-client-wsrep',
}

package { 'python-mysqldb' :
  ensure => 'present',
  name   => 'MySQL-python',
}

stage { 'main' :
}

